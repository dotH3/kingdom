---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

// Get all posts and filter out drafts
const allPosts = await getCollection('posts');
const posts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<BaseLayout title="Kingdom - Blog" description="A minimalist blog">
  <h1>Posts</h1>
  
  {posts.length === 0 ? (
    <p>No posts yet. Check back soon!</p>
  ) : (
    <div style="display: flex; flex-direction: column; gap: 2rem;">
      {posts.map((post) => (
        <article style="background: var(--card-bg); border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px;">
          <h2 style="margin-top: 0;">
            <a href={`/kingdom/web/${post.data.postSlug}`}>{post.data.title}</a>
          </h2>
          <p style="color: var(--accent); font-size: 0.9rem; margin-bottom: 0.5rem;">
            {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </p>
          <p>{post.data.desc}</p>
          {post.data.tags.length > 0 && (
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
              {post.data.tags.map((tag) => (
                <span style="background: var(--accent); color: var(--bg); padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.85rem;">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </article>
      ))}
    </div>
  )}
</BaseLayout>
